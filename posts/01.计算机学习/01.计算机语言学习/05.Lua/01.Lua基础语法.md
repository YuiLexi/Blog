---
title: Lua基础语法
date: 2024/3/7 00:01:01
updated: 

categories: 
  - [Unity3D, Unity3D基础]
  - [Lua, Lua基础语法]
tags: [计算机, 离散数学]
keywords: 
description: 

mathjax: true
katex: true

imghost_path: Blog/Post/01.计算机学习/02.计算机基础学习/04.离散数学/01.命题与逻辑.md/

top_img: 
comments: 
cover: https://imagehost.yuilexi.cn/Blog/Post/01.计算机学习/01.计算机语言学习/05.Lua/01.Lua基础语法.md/Cover.png

toc: 
toc_number: 
toc_style_simple: 
copyright: 
copyright_author: 
copyright_author_href: 
copyright_url: 
copyright_info: 
aplayer: 
highlight_shrink: 
aside: 
---

# 一、

# 二、Lua基础

## 2.1 第一个Lua程序

~~~lua
print("Hello, world!")
~~~

> 注意：在 `Lua` 语法中，语句的结尾可以添加 “;”，也可以选择不添加 “;”，但是习惯上不添加 “;”。

## 2.2 注释

俗话说的好：我讨厌两种人，一是不写注释的人；二是让我写注释的人。尽管如此，良好的注释习惯不仅能提升代码的美观度和可读性，而且便于后期迭代修改。因此，养成写注释的好习惯是写代码的第一步。

基本上所有的计算机语言都有注释，而在 `Lua` 语言中，支持的注释类型有两种，分别是：

1. 单行注释

    ~~~lua
    print("**********单行注释**********")
    -- 我是单行注释
    ~~~

    这里是两个短横线 “-”。

2. 多行注释

    ~~~lua
    print("**********多行注释**********")
    --[[
    我是多行注释
    1
    ]]
    
    --[[
    我是多行注释
    2
    ]]
       --
    
    --[[
    我是多行注释
    3
    --]]
    ~~~

## 2.3 基础变量类型

在 `Lua` 语言中，所有的变量类型总结起来一共有 8 种，分别是：

|   nil    |           number           |   string   |   boolean    | table  | function | userdata |  thread  |
| :------: | :------------------------: | :--------: | :----------: | :----: | :------: | :------: | :------: |
| 表示NULL | 表示数字，包含整数和浮点数 | 表示字符串 | 表示布尔类型 | 表类型 | 函数类型 | 数据结构 | 协同程序 |

本节中，主要讲解前四种基础变量类型，而后四种的复杂变量类型放在以后的小节中。



首先，在 `Lua` 语言中，声明变量是不需要指明其类型的，系统能够自动推断出变量的类型，属于**弱语言**。

~~~lua
-- 1. nil变量
print("**********nil变量**********")
a = nil
print("a的值:", a, "    a的类型:", type(a))

-- 2. number变量
print("**********number变量**********")
num = 100
print("num的值:", num, "    num的类型:", type(num))
number = 73.123123
print("number的值:", number, "    number的类型:", type(number))

-- 3. string变量
print("**********string变量**********")
str = "Hello, World!"
print("str的值:", str, "    str的类型:", type(str))

-- 4. boolean变量
print("**********boolean变量**********")
bool = true
print("bool的值:", bool, "    bool的类型:", type(bool))
~~~

从上面的代码中，我们能得到：

1. 变量的类型是根据其赋值所决定的；

    疑问：如果一个没有赋值的变量，那么它的类型是什么呢？

    答案：

    ~~~lua
    print("变量 “ABCD” 的类型是", type(ABCD))
    
    --[[结果为:
    变量 “ABCD” 的类型是	nil
    ]]
    ~~~

    由此可见，使用为定义的变量时，系统并不会报错，并且未定义的变量的类型为 `nil` 。

2. 同一变量名可以进行多次赋值，并且取最后赋的值。

    疑问：如果我将一个变量赋**不同类型的变量**，是否可取？结果又会是什么呢？

    答案：

    ~~~lua
    print("**********变量的多次赋值**********")
    a = 10
    print("a的值:", a, "    a的类型:", type(a))
    a = "Hello, World!"
    print("a的值:", a, "    a的类型:", type(a))
    
    --[[
    结果为:
    **********变量的多次赋值**********
    a的值:	10	    a的类型:	number
    a的值:	Hello, World!	    a的类型:	string
    ]]
    ~~~

> Tip：在 `Lua` 语言中，可以使用 `type(..)` 函数来获取变量类型，其返回值是一个字符串。
>
> ~~~lua
> print("**********type()**********")
> print(type(10))
> print(type(type(10)))
> 
> --[[
> 结果为:
> **********type()**********
> string
> string
> ]]
> ~~~
>
> 

## 2.4 字符串

在 `Lua` 语言中，针对字符的变量类型只有字符串 `string` ，没有字符 `char` 。

**对于字符串的表示，既可以使用双引号，也可以使用单引号**。

~~~lua
print("**********字符串的声明**********")
str = "Hello, World!"
str2 = '你好'
~~~

对于字符串来讲，我们使用字符串，不仅会要学会创建字符串，而且还必须学会如可操作字符串，例如：获取字符串长度、拼接字符串、大小写转换、查找、截取、重复、替换等。



首先，给出字符串多行打印的方法，并且 `Lua` 语言中，**字符串支持转义字符**；而字符串类型的转换，是通过函数 `tostring(..)` 来完成的。

```lua
print("**********多行打印**********")
print("12345\n67890\n")
str3 = [[
我是
多行打印
!!!!
]]
print(str3)

--[[
结果为:
**********多行打印**********
12345
67890

我是
多行打印
!!!!
]]

print("**********字符串的转换**********")
str4 = "123"
print("str4的值:", str4, "    str4的类型:", type(str4))
str4 = tonumber(str4)
print("str4的值:", str4, "    str4的类型:", type(str4))
str4 = tostring(str4)
print("str4的值:", str4, "    str4的类型:", type(str4))

--[[
结果为:
**********字符串的转换**********
str4的值:	123	    str4的类型:	string
str4的值:	123	    str4的类型:	number
str4的值:	123	    str4的类型:	string
]]
```



对于如何获取字符串的长度，通过 `#` 符号来进行操作的，其使用方法如下：

~~~lua
print("**********字符串的长度**********")
str5 = "Hello, World!"
print("str5的长度:", #str5)
str6 = "你好"
print("str6的长度:", #str6)
print(type(#str6))
--[[
结果为:
**********字符串的长度**********
str5的长度:	13
str6的长度:	6
number
]]
~~~

> 注意：在 `Lua` 语言中，通过 `#` 获取字符串的长度，并不是字符数，而是返回的字节数（汉字占三个字节）。



字符串的拼接：使用 `..` 操作符。

~~~lua
print("**********字符串的连接**********")
str7 = "Hello, "
str8 = "World!"
print(str7 .. str8)

--[[
结果为:
**********字符串的连接**********
Hello, World!
]]
~~~

还可以使用模式匹配的方式：

~~~lua
print("**********模式匹配**********")
print(string.format("我已经使用了 %d 天的Lua", 7))
--[[
结果为:
**********模式匹配**********
我已经使用了 7 天的Lua
]]
~~~



而对于字符串的其余操作，其用法如下：

~~~lua
print("**********字符串的操作**********")
str9 = "abcDEFghabc"
-- 1. 小写转大写
print(string.upper(str9))
-- 2. 大写转小写
print(string.lower(str9))
-- 3. 反转
print(string.reverse(str9))
-- 4. 查找
print(string.find(str9, "abc"))
-- 5. 截取
print(string.sub(str9, 4, 6))
-- 6. 替换
print(string.gsub(str9, "abc", "***"))
-- 7. 重复
print(string.rep(str9, 3))
-- 8. 匹配
print(string.match(str9, "DEF"))

--[[
结果为:
**********字符串的操作**********
ABCDEFGHABC
abcdefghabc
cbahgFEDcba
1	3
DEF
***DEFgh***	2
abcDEFghabcabcDEFghabcabcDEFghabc
DEF
]]
~~~

函数 `find()` 返回值有两个，表明查找到两处，位置分别是 1 和 3；函数 `gsub()` 最后输出一个数字，表明替换的次数。

> 注意：在 `Lua` 语言中，字符串的索引是从 “1” 开始的，这一点需要和替他语言进行区分。在后面的学习中，其实发现，涉及到索引的，默认都是从 “1” 开始，而不是从 “0” 开始。

## 2.5 运算符

在 `Lua` 语言中，运算符的种类分为三种：**算术运算符**、**条件运算符**和**逻辑运算符**。

1. 算术运算符：`+  -  *  /  %  ^` （加、减、乘、除、取余、幂）；

    > **在 `Lua` 语言中，没有自增自减运算符（`++ --`），同时也没有复合运算符（`+= -= *= /= %=`）**。

    `string` 与 `number` 类型运算时，如果 `string` 可以被转换成 `number` ，那么会得到 `number` 类型的结果。

    ```lua
    print("**********算术运算符**********")
    print("12.3" + 2)
    print("12.3" - 2)
    print("12.3" * 2)
    print("12.3" / 2)
    print("12.3" % 2)
    
    --[[
    结果为:
    **********算术运算符**********
    14.3
    10.3
    24.6
    6.15
    0.3
    ]]
    
    ```

    

2. 条件(关系)运算符：`>  <  >=  <=  ==  ~=` （大于、小于、大于等于、小于等于、等于、不等于）

3. 逻辑运算符：`and  or  not` （与、或、非）。

    在 `Lua` 语言中，“与” 和 “或” 都遵循逻辑电路的 “短路” 原则。

> 在 `Lua` 语言中，**不支持位运算符和三目运算符**。

# 三、流程控制语句

## 3.1 条件分支语句

在 `Lua` 语言中，基本的 `if` 语句如下：

~~~lua
if [条件表达式] then
    [分支]
else
    [分支]
end
~~~

例如：

~~~lua
a = 9
if a > 5 then
    print("a大于5")
else
    print("a小于5")
end

--[[结果为:
a大于5
]]
~~~



多分支语句：

~~~lua
a = 5
if a > 5 then
    print("a大于5")
elseif a < 5 then
    print("a小于5")
else
    print("a等于5")
end

--[[结果为:
a大于5
]]
~~~



> 注意：**在`Lua`语法中，没有`switch`语法**。

## 3.2 循环语句

1. `while`循环

    基本语法格式如下：

    ~~~lua
    while [条件表达式] do
        [循环体]
    end
    ~~~

    

2. "`do-while`" `repeat`循环

    基本语法格式如下：

    ~~~lua
    repeat
        [循环体]
    until [结束条件判断表达式]
    ~~~

    

3. `for`循环

    基本语法格式如下：

    ```lua
    for i = [初值], [目标值(不包含)], [step] do
        [循环体]
    end
    ```

    - 在`Lua`语言中，`for`循环会自行累计计数，不需要手动著名`i = i + 1`；
    - `step`是步长，也就是每一次迭代，`i`变换的量，**默认是 “1”**；
    - 初值和目标值是左开右闭（区间）范围，也就是相当于 “初值 <= X < 目标值”。

# 四、函数💲

## 4.1 函数的定义

在`Lua`语言中，函数的表示方式有两种，分别是：

~~~lua
function Name()
    [函数体]
end
Name()

Name = function()
    [函数体]
end
Name()
~~~

> Tips：在前面的学习中提到过函数`function`也是一种特殊的变量，而第二种表示方式就类似于变量的定义。
>
> 注意：在`Lua`语言中，由于是解释型语言，系统逐行进行执行的，因此**不能将函数的执行放在函数的定义之前**。
>
> ~~~lua
> -- 这样的代码会报错
> Name()
> Name = function()
>     print("I'm a function")
> end
> ~~~



对于含有参数的函数，在定义的时候不需要指明参数的类型，因此，在函数处理的时候，就要做好应对多种数据类型的准备，例如：

~~~lua
F1 = function(a)
    print("你输入的是：", a)
end

F1(nil)
F1(1)
F1("Hello, World!")
F1(true)
F1()
F1(1, 2, 3)

--[[结果为:
你输入的是：	nil
你输入的是：	1
你输入的是：	Hello, World!
你输入的是：	true
你输入的是：	nil
你输入的是：	1
]]
~~~

> 注意：**当执行有参的函数时，如果输入零个参数，那么会按照`nil`对每个参数进行处理；如果输入的参数多于定义的参数，那么会默认忽略多余的参数**。



对于有返回值的参数，在函数体内部使用`return`语句，并且**可以有多返回值**。

~~~lua
print("**********函数的返回值**********")
F2 = function(a, b)
    return a + b
end
print(F2(1, 2))

F3 = function(a, b)
    return a, b, a + b
end
a, b, c = F3(1, 2)
print(a, b, c)
~~~

对于多返回值，可以声明多个变量来接收，如果接收者多于返回者，那么多余的接收者为`nil`；如果接收者小于返回者，那么多余的返回者丢弃。

> 在`Lua`语言中，如果中间某个返回值不想要，可以使用弃元`_`（单下划线），作为接收的占位符。

## 4.2 函数的重载

先回答一下什么是函数额重载：函数名相同，但是函数的参数不同，称为**函数的重载**。

在`Lua`语言中，不支持函数的重载，执行函数时，会默认调取最后一次赋值的函数变量。

## 4.3 变长参数

在`Lua`语言中，如果希望函数传入多个参数，但是参数的个数不确定，可以使用变长参数，例如：

~~~lua
print("**********函数的可变参数**********")
F4 = function(...)
    local sum = 0
    for i, v in ipairs { ... } do
        sum = sum + v
    end
    return sum
end
print(F4(1, 2, 3, 4, 5))
print(F4(1, 2, 3, 4, 5, 6, 7, 8, 9, 10))
--[[结果为:
**********函数的可变参数**********
15
55
]]
~~~

在上面代码中，定义函数的参数时，使用`...`（三个点）表示参数，那么在执行函数的时候，就能传入多个参数。这些传入函数的参数，是通过转换成表`table`类型的变量来操作的，对于表`table`的相关知识，在后续的章节中，会进行细致的讲解。

## 4.4 函数的嵌套(闭包)

函数作为一种变量类型，可以**以返回值的形式**进行使用，这就是函数的嵌套。例如：

~~~lua
F5 = function()
    return function()
        print("函数的嵌套")
    end
end

F6 = F5() -- 此时的F6是一个函数，调用F6()即可调用F5()返回的函数
F6()
--[[结果为:
函数的嵌套
]]
~~~



闭包的实现方式：改变变量的生命周期

~~~lua
F1 = function(k)
    return function(a)
        return a * k
    end
end

F2 = F1(2)
print(F2(3))
print(F2(4))
--[[结果为:
6
8
]]
~~~

如何理解上面的代码呢？

首先定义函数变量`F1`，而函数`F2`就是返回值里面的函数，并且`k`恒为“1”。因此，无论调用`F2(..)`时输入是什么，`k`必定是“1”，这样，这个变量值就被锁定在函数`F2`内部。



# 五、复杂数据结构——表

## 5.1 数组

### 5.1.1 数组基础

数组的创建方式，通过大括号 “{ }” 创建，并且数组内的元素用逗号 “,” 隔开。基本语法如下：

~~~lua
a = { 1, 2.4, "Hello, World!", true, nil }
~~~

> 注意：在`Lua`语言中，数组的元素类型可以不相同。



数组可以通过索引来获取内部元素，并且**要注意，索引是从 “1” 开始的**，但是如果使用小于1的索引，并不会出错，而是输出为`nil`。（这里可以更加加深`nil`类型的概念，就是“无”、“空”）

~~~lua
a = { 1, 2.4, "Hello, World!", true, nil }
print(a[0], a[1], a[2], a[3], a[4], a[5])
--[[结果为:
nil	1	2.4	Hello, World!	true	nil
]]
~~~



~~**获取数据的长度依旧是使用`#`，并且只会从 “1” 开始，到遇到`nil`结束。也就是说，如果一个数组的元素都不为`nil`，那么相当于在其尾部跟随一个`nil`；而如果在数组的中间段某个元素为`nil`，那么数组的长度就到此为止**~~。

> **注意：在新版本`Lua`中，`#`可以获取数组的全部元素，如果中间某个元素为`nil`，也会输出数组全部元素的个数**。

~~~lua
b = { 1, 2.4, nil, "Hello, World!", true }
print(#b)
--[[结果为:
2
]]

--新版本的输出
--[[结果为:
5
]]
~~~

> Tips：在`Lua`语言中，`#`是一个通用的获取长度的关键字。

### 5.1.2 数据的遍历

使用`for`循环进行数组的遍历，代码如下：

~~~lua
print("**********数组的遍历**********")
array = { 1, 2.4, "Hello, World!", nil, 2, true }
for i = 1, #array, 1 do
    print(array[i])
end
~~~

~~上面的遍历是根据获取数组的长度，进行计数遍历的。但是很明显，打印的信息表明，并未将数组中的所有元素进行输出，因此这种**遍历方式不可靠**。~~

> 注意：在新版本`Lua`中，`#`可以获取数组的全部元素，如果中间某个元素为`nil`，也会输出数组全部元素的个数。
>

### 5.1.3 二维数组

二维数组的定义如下：

~~~lua
array2 = { { 1, 2 }, { "Hello, World!", true } }
~~~

这里需要了解到，其实在`Lua`语言中，`table`是一种很宽泛的概念，数组也是`table`的一种。而`table`里面的元素可以是任何数据类型，当然也包括`table`。当`table`作为`table`的元素时，从形式上来看，就类似于`C#`当中的二维数组。因此，在学习`Lua`语言的`table`，需要更深一步去理解，并且也要学会灵活运用。



### 5.1.4 自定义索引

基本格式如下：

~~~lua
array3 = { [0] = 1, 2, [3] = 3, [-1] = 4 }
print(array3[0], array3[1], array3[2], array3[3], array3[-1])
print(#array3)
--[[结果为:
**********自定义索引**********
1	2	nil	3	4
1
]]
~~~

为什么获取数组的长度会是 “1” 呢？其实，数组对应的值如下：

| 索引 |  0   |  1   |  3   |  -1  |
| :--: | :--: | :--: | :--: | :--: |
|  值  |  1   |  2   |  3   |  4   |

~~对于获取数组的长度，是从索引 “1” 开始的，因此，索引小于 “1” 的全部元素无法获取，并且由于没有索引为 “2” 的元素，因此也识别不到索引为 “3” 的元素，**从索引 “1” 开始的连续索引，进行计数**。~~

~~但是，如果连续的索引当中，被拿走**一个**，例如：1-2-3-5-6，那么会根据返回索引的最大值 “6”作为数组的长度，如果是1-2-3-6，那么就只会输出 “3” 。~~

> 经过多次测试，发现 1-2-4-5 输出 5 ；1-2-3-5 输出 3 ；1-2-3-4-6-7 输出  7 。本人推测，可能是奇偶数不同，输出的结果就不同，这里可能是底层代码的问题。























